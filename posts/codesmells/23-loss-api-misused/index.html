<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Loss API Misused | DSLinter - Linter for Machine Learning - Specific Code Smells</title><meta name=keywords content="api-specific,model training,error-prone">
<meta name=description content="Check the input for loss API in PyTorch carefully.">
<meta name=author content>
<link rel=canonical href=https://hynn01.github.io/dslinter/posts/codesmells/23-loss-api-misused/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/dslinter/assets/css/stylesheet.min.118d582b9317eeb0017c428ab7f64c4be58e68881aeb263d9b75c61866e244de.css integrity="sha256-EY1YK5MX7rABfEKKt/ZMS+WOaIga6yY9m3XGGGbiRN4=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/dslinter/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.93.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Loss API Misused">
<meta property="og:description" content="Check the input for loss API in PyTorch carefully.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://hynn01.github.io/dslinter/posts/codesmells/23-loss-api-misused/"><meta property="article:section" content="posts">
<meta property="og:site_name" content="DSLinter - Linter for Machine Learning Application - Specific Code Smells">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Loss API Misused">
<meta name=twitter:description content="Check the input for loss API in PyTorch carefully.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hynn01.github.io/dslinter/posts/"},{"@type":"ListItem","position":2,"name":"Code Smells","item":"https://hynn01.github.io/dslinter/posts/codesmells/"},{"@type":"ListItem","position":3,"name":"Loss API Misused","item":"https://hynn01.github.io/dslinter/posts/codesmells/23-loss-api-misused/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Loss API Misused","name":"Loss API Misused","description":"Check the input for loss API in PyTorch carefully.","keywords":["api-specific","model training","error-prone"],"articleBody":"Description Context Loss functions are always used in optimization problems.\nProblem Different loss APIs accept different input formats, but the distinction is not made in some documentation or is overlooked by some developers, making it easy to misuse. For example, in PyTorch, the NLLLoss takes the output of LogSoftmax as the input. If the input given to NLLLoss has not been processed by LogSoftmax, it may lead to a wrong result.\nSolution Developers should check whether they use the loss API in PyTorch correctly.\nType API-Specific\nExisting Stage Model Training\nEffect Error-prone\nExample ### PyTorch import torch.nn as nn import torch  + m = nn.LogSoftmax(dim=1) loss = nn.NLLLoss() input = torch.randn(3, 5, requires_grad=True) target = torch.tensor([1, 0, 4]) - output = loss(input, target) + output = loss(m(input), target) output.backward() Source: Paper Grey Literature  https://medium.com/missinglink-deep-learning-platform/most-common-neural-net-pytorch-mistakes-456560ada037  GitHub Commit Stack Overflow Documentation ","wordCount":"139","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://hynn01.github.io/dslinter/posts/codesmells/23-loss-api-misused/"},"publisher":{"@type":"Organization","name":"DSLinter - Linter for Machine Learning - Specific Code Smells","logo":{"@type":"ImageObject","url":"https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E"}}}</script>
</head><body id=top>
<script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://hynn01.github.io/dslinter/ accesskey=h title="DSLinter - Linter for Machine Learning - Specific Code Smells (Alt + H)">DSLinter - Linter for Machine Learning - Specific Code Smells</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div><ul id=menu>
<li>
<a href=https://hynn01.github.io/dslinter/posts/codesmells/ title="Code Smells">
<span>Code Smells</span>
</a>
</li><li>
<a href=https://hynn01.github.io/dslinter/tags/ title=Tags>
<span>Tags</span>
</a>
</li><li>
<a href=https://hynn01.github.io/dslinter/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li></ul></nav></header><main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://hynn01.github.io/dslinter/>Home</a>&nbsp;»&nbsp;<a href=https://hynn01.github.io/dslinter/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://hynn01.github.io/dslinter/posts/codesmells/>Code Smells</a></div><h1 class=post-title>
Loss API Misused
</h1><div class=post-meta>
</div></header><div class=post-content><h3 id=description>Description<a hidden class=anchor aria-hidden=true href=#description>#</a></h3><h3 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>#</a></h3><p>Loss functions are always used in optimization problems.</p><h4 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h4><p>Different loss APIs accept different input formats, but the distinction is not made in some documentation or is overlooked by some developers, making it easy to misuse. For example, in PyTorch, the <code>NLLLoss</code> takes the output of <code>LogSoftmax</code> as the input. If the input given to <code>NLLLoss</code> has not been processed by <code>LogSoftmax</code>, it may lead to a wrong result.</p><h4 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h4><p>Developers should check whether they use the loss API in PyTorch correctly.</p><h3 id=type>Type<a hidden class=anchor aria-hidden=true href=#type>#</a></h3><p>API-Specific</p><h3 id=existing-stage>Existing Stage<a hidden class=anchor aria-hidden=true href=#existing-stage>#</a></h3><p>Model Training</p><h3 id=effect>Effect<a hidden class=anchor aria-hidden=true href=#effect>#</a></h3><p>Error-prone</p><h3 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>### PyTorch
</span></span><span style=display:flex><span>import torch.nn as nn
</span></span><span style=display:flex><span>import torch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>+ m = nn.LogSoftmax(dim=1)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>loss = nn.NLLLoss()
</span></span><span style=display:flex><span>input = torch.randn(3, 5, requires_grad=True)
</span></span><span style=display:flex><span>target = torch.tensor([1, 0, 4])
</span></span><span style=display:flex><span><span style=color:#f92672>- output = loss(input, target)
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+ output = loss(m(input), target)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>output.backward()
</span></span></code></pre></div><h3 id=source>Source:<a hidden class=anchor aria-hidden=true href=#source>#</a></h3><h4 id=paper>Paper<a hidden class=anchor aria-hidden=true href=#paper>#</a></h4><h4 id=grey-literature>Grey Literature<a hidden class=anchor aria-hidden=true href=#grey-literature>#</a></h4><ul>
<li><a href=https://medium.com/missinglink-deep-learning-platform/most-common-neural-net-pytorch-mistakes-456560ada037>https://medium.com/missinglink-deep-learning-platform/most-common-neural-net-pytorch-mistakes-456560ada037</a></li></ul><h4 id=github-commit>GitHub Commit<a hidden class=anchor aria-hidden=true href=#github-commit>#</a></h4><h4 id=stack-overflow>Stack Overflow<a hidden class=anchor aria-hidden=true href=#stack-overflow>#</a></h4><h4 id=documentation>Documentation<a hidden class=anchor aria-hidden=true href=#documentation>#</a></h4></div><footer class=post-footer>
<ul class=post-tags>
<li><a href=https://hynn01.github.io/dslinter/tags/api-specific/>api-specific</a></li><li><a href=https://hynn01.github.io/dslinter/tags/model-training/>model training</a></li><li><a href=https://hynn01.github.io/dslinter/tags/error-prone/>error-prone</a></li></ul><nav class=paginav>
<a class=prev href=https://hynn01.github.io/dslinter/posts/codesmells/22-gradients-not-cleared-before-backward-propagation/>
<span class=title>« Prev Page</span>
<br>
<span>Gradients Not Cleared before Backward Propagation</span>
</a>
<a class=next href=https://hynn01.github.io/dslinter/posts/codesmells/24-dataloader-unused/>
<span class=title>Next Page »</span>
<br>
<span>DataLoader Unused</span>
</a>
</nav></footer></article></main><footer class=footer>
<span>&copy; 2022 <a href=https://hynn01.github.io/dslinter/>DSLinter - Linter for Machine Learning - Specific Code Smells</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script>
</body></html>